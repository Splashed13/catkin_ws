#!/usr/bin/env python3

import rospy
from std_msgs.msg import Float32MultiArray
import subprocess

def id_callback(data):
    # Check if the ID is detected (non-zero positive value)

    aruco_id = data.data
    if aruco_id(-1) >= 0:
        # Log the numeric data received
        rospy.loginfo("Received numeric data: %d", aruco_id(-1))
        
        # Use eSpeak to synthesize the speech
        try:
            subprocess.run(['espeak', f'The number detected is {aruco_id(-1)}'], check=True)
        except subprocess.CalledProcessError as e:
            rospy.logerr(f"Error running eSpeak: {e}")
    else:
        # Log that the ID is not found
        rospy.loginfo("ID not found")
        
        # Use eSpeak to synthesize the speech for ID not found
        try:
            subprocess.run(['espeak', 'ID not found'], check=True)
        except subprocess.CalledProcessError as e:
            rospy.logerr(f"Error running eSpeak: {e}")

def main():
    rospy.init_node('espeak_subscriber', anonymous=True)
    rospy.Subscriber('/aruco_corners', Float32MultiArray, id_callback)
    rospy.loginfo('espeak activated')
    rospy.spin()

if __name__ == '__main__':
    main()
